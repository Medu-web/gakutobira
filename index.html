<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ãƒˆãƒ“ãƒ©</title>
    <style>
        /* ------------------------------------- */
        /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        /* ------------------------------------- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
            text-align: center;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }

        h1 {
            color: #0056b3;
            margin-bottom: 5px;
            font-size: 2.2em;
            padding-top: 10px;
        }

        /* ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«è¦ç´ ã‚’å‰Šé™¤ã—ãŸãŸã‚ã€ã“ã“ã«ã¯ã‚¹ã‚¿ã‚¤ãƒ«ã¯æ®‹ã—ã¾ã›ã‚“ */
        
        /* ------------------------------------- */
        /* ãƒœã‚¿ãƒ³ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        /* ------------------------------------- */
        .section-title {
            color: #0056b3;
            border-bottom: 3px solid #0056b3;
            padding-bottom: 5px;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .link-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 15px;
            background-color: #e9f0f8;
            color: #0056b3;
            text-decoration: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            min-height: 80px;
            text-align: left;
            line-height: 1.3;
            perspective: 1000px;
            border: 2px solid #b3e0ff;
        }

        .link-button:hover {
            background-color: #d0e0f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* ------------------------------------- */
        /* ãƒ‰ã‚¢ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        /* ------------------------------------- */
        .door-icon {
            /* ãƒ‰ã‚¢ã®åŸºæœ¬çš„ãªç®± */
            position: relative;
            width: 24px;
            height: 32px;
            background-color: #a0522d; /* èŒ¶è‰²ã®ãƒ‰ã‚¢ */
            border: 2px solid #8B4513;
            border-radius: 4px 4px 0 0;
            margin-right: 15px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
            
            /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬è¨­å®š */
            transform-origin: left center; /* å·¦ç«¯ã‚’è»¸ã«å›è»¢ */
            transition: transform 0.5s ease-out, opacity 0.5s ease-out; 
            transform: rotateY(0deg); /* åˆæœŸçŠ¶æ…‹ */
        }
        
        /* === ãƒ‰ã‚¢ãŒé–‹ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ === */
        .link-button.opening .door-icon {
            transform: rotateY(-110deg);
            opacity: 0;
        }

        /* ãƒ‰ã‚¢ã®å–ã£æ‰‹ */
        .door-icon::after {
            content: '';
            position: absolute;
            top: 10px;
            right: 5px;
            width: 4px;
            height: 4px;
            background-color: #ffd700; /* ã‚´ãƒ¼ãƒ«ãƒ‰ã®å–ã£æ‰‹ */
            border-radius: 50%;
        }

        .button-text {
            flex-grow: 1;
            text-align: center;
        }

        /* ------------------------------------- */
        /* ç·Šæ€¥å¯¾å¿œã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¼·èª¿ */
        /* ------------------------------------- */
        .emergency-section {
            margin-top: 40px;
            padding: 20px;
            border: 4px solid #cc0000;
            background-color: #ffe6e6;
            border-radius: 12px;
        }

        .emergency-section .section-title {
            color: #cc0000;
            border-bottom: 3px solid #cc0000;
        }
        
        .emergency-description {
            color: #cc0000;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* ç·Šæ€¥ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« (èµ¤è‰²ç³»ã®ãƒ‰ã‚¢) */
        .emergency-button {
            background-color: #ff9900;
            color: #333;
            border: 3px solid #cc7a00;
            font-size: 1.2em;
            padding: 25px 15px;
        }

        .emergency-button:hover {
            background-color: #ffc04d;
            color: #000;
        }
        
        /* ç·Šæ€¥ãƒœã‚¿ãƒ³ã®ãƒ‰ã‚¢ã®è‰²ã‚’è­¦å‘Šè‰²ã« */
        .emergency-button .door-icon {
            background-color: #cc3333; 
            border-color: #a00000;
        }

        /* ------------------------------------- */
        /* ç®¡ç†è€…æ©Ÿèƒ½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        /* ------------------------------------- */
        #edit-button {
            background-color: #3cb371; /* Medium Sea Green */
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            margin-top: 10px;
            margin-bottom: 20px;
            transition: background-color 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        #edit-button:hover {
            background-color: #2e8b57; /* Sea Green */
        }
        
        /* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: è¦ç´ ã‚’å®Œå…¨ã«éè¡¨ç¤ºã«ã™ã‚‹ */
        .hidden {
            display: none !important;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none; /* åˆæœŸã¯éè¡¨ç¤º */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content textarea {
            width: 100%;
            height: 300px;
            min-height: 200px;
            margin-top: 10px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        .modal-buttons button {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .modal-save {
            background-color: #0056b3;
            color: white;
            border: none;
        }
        
        .modal-cancel {
            background-color: #ccc;
            color: #333;
            border: none;
        }
        
        .modal-title {
            font-size: 1.5em;
            color: #0056b3;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ (ãƒ¢ãƒã‚¤ãƒ«å‘ã‘) */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .link-button, .emergency-button {
                min-height: 60px;
                font-size: 1em;
            }
            .door-icon {
                margin-right: 10px;
                width: 20px;
                height: 28px;
            }
            .modal-content {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><ruby>å­¦<rt>ã‚¬ã‚¯</rt></ruby>ãƒˆãƒ“ãƒ©</h1>
        <p class="subtitle">ã•ã‚ã€å­¦ç¿’ã®æ‰‰ã‚’é–‹ã“ã†ï¼</p>

        <!-- ç®¡ç†è€…ç·¨é›†ãƒœã‚¿ãƒ³ã‚’è¿½åŠ  -->
        <button id="edit-button" class="hidden" onclick="handleEditClick()">ãƒãƒ¼ã‚¿ãƒ«ã‚’ç·¨é›†</button>

        <!-- ------------------------------------- -->
        <!-- å­¦ç¿’Webã‚¢ãƒ—ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ (ãƒ¡ã‚¤ãƒ³) -->
        <!-- ------------------------------------- -->
        <h2 class="section-title" id="main-section-title">ğŸ“— ã„ã¤ã‚‚ã®å­¦ç¿’ã®æ‰‰</h2>
        
        <div class="link-grid" id="link-container">
            <!-- å‹•çš„ã«ãƒªãƒ³ã‚¯ãŒæŒ¿å…¥ã•ã‚Œã¾ã™ -->
        </div>


        <!-- ------------------------------------- -->
        <!-- ç·Šæ€¥å¯¾å¿œã‚»ã‚¯ã‚·ãƒ§ãƒ³ (ãƒˆãƒ©ãƒ–ãƒ«å›é¿) - JSã§è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡ -->
        <!-- ------------------------------------- -->
        <div class="emergency-section hidden" id="emergency-section">
            <h2 class="section-title">ğŸš¨ ç·Šæ€¥å¯¾å¿œã®æ‰‰ï¼šã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚„ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±ã®ãƒˆãƒ©ãƒ–ãƒ«æ™‚</h2>
            <p class="emergency-description">
                **ã€é‡è¦ã€‘** OneDriveãƒ•ã‚©ãƒ«ãƒ€ã‚„ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒª(Teams/Office)ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã§ããªã„å ´åˆã¯ã€**å¿…ãšã“ã®ãƒªãƒ³ã‚¯**ã‹ã‚‰Webãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚
            </p>
            
            <div class="link-grid">
                <!-- Microsoft 365 ãƒãƒ¼ã‚¿ãƒ«ã«ã¾ã¨ã‚ã¦èª˜å° -->
                <a href="https://portal.office.com/" class="link-button emergency-button" target="_blank">
                    <span class="door-icon"></span><span class="button-text">Microsoftã®ã‚¹ã‚¿ãƒ¼ãƒˆãƒšãƒ¼ã‚¸<br>(Webç‰ˆ Office, Teams, OneDriveã¯ã“ã¡ã‚‰)</span>
                </a>

                <!-- ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ‰‹é †æ›¸ (å¾©æ—§ãƒãƒ‹ãƒ¥ã‚¢ãƒ«) -->
                <a href="[ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ‰‹é †æ›¸PDFã®URLã‚’ã“ã“ã«è¨˜è¿°]" class="link-button emergency-button" target="_blank">
                    <span class="door-icon"></span><span class="button-text">ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¾©æ—§æ‰‹é †æ›¸<br>ï¼ˆãƒˆãƒ©ãƒ–ãƒ«è§£æ±ºãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼‰</span>
                </a>
            </div>
        </div>

        <!-- ------------------------------------- -->
        <!-- ãƒ•ãƒƒã‚¿ãƒ¼æƒ…å ± - å‰Šé™¤ -->
        <!-- ------------------------------------- -->
        
    </div>
    
    <!-- ------------------------------------- -->
    <!-- JSONç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« (ç®¡ç†ç”»é¢) -->
    <!-- ------------------------------------- -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title">ãƒãƒ¼ã‚¿ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†: #default</h3>
            <p id="edit-warning" style="color: #cc0000; font-weight: bold; font-size: 0.9em;">
                âš ï¸ JSONå½¢å¼ï¼ˆ{"name": "...", "url": "..."} ã®é…åˆ—ï¼‰ã‚’å´©ã•ãªã„ã§ãã ã•ã„ã€‚<br>
                ç·¨é›†å†…å®¹ã¯ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚
            </p>
            <textarea id="json-editor"></textarea>
            <div class="modal-buttons">
                <button class="modal-cancel" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-save" onclick="saveChanges()">ä¿å­˜ã—ã¦é©ç”¨</button>
            </div>
        </div>
    </div>

    <script>
        // ----------------------------------------------------
        // ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ã™ã‚‹ãŸã‚ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
        const LOCAL_STORAGE_KEY = 'gakuTobiraPortalDataV3'; // ã‚­ãƒ¼
        
        // å…±é€šã®ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ç·¨é›†ç”¨)
        const ADMIN_PASSWORD = 'admin123';
        
        // å­¦æ ¡å›ºæœ‰ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å®šç¾© (å­¦æ ¡ã‚³ãƒ¼ãƒ‰ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«å¯¾å¿œ)
        const SCHOOL_PASSWORDS = {
            's/01-e': 'e01_portal', 
            's/04-e': 'e04_portal', 
            's/07-e': 'e07_portal', // ä¾‹ã¨ã—ã¦æ®‹ã™
            's/11-j': 'j11_portal', 
        };
        
        // å…±é€šã®åŸºæœ¬ãƒªãƒ³ã‚¯æ§‹é€ ã‚’å®šç¾© (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã®å†…å®¹)
        const defaultLinks = [
            { name: 'eãƒ©ã‚¤ãƒ–ãƒ©ãƒª', url: "https://ela.education.ne.jp/students/" },
            { name: 'ãƒ‰ãƒªãƒ«ãƒ—ãƒ©ãƒãƒƒãƒˆ', url: "https://login.kobun.co.jp/student-login/?code=1134304" },
            { name: 'NHK for School', url: "https://www.nhk.or.jp/school/" },
            { name: 'æ–‡ç§‘çœ GIGAã‚¹ã‚¯ãƒ¼ãƒ«é–¢é€£æƒ…å ±', url: "https://www.mext.go.jp/a_menu/other/index_00001.htm" },
        ];


        /**
         * éšå±¤å‹ãƒãƒ¼ã‚¿ãƒ«è¡¨ç¤ºç”¨ã®è¨­å®šãƒ‡ãƒ¼ã‚¿ (åˆæœŸå€¤)
         * â€» ä»¥ä¸‹ã®å®šç¾©ã¯ã€è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ãã•ã‚Œãªã„ã‚ˆã†ã«ã€ç‰¹æ®Šãªæ§‹æˆã‚’æŒã¤ãƒšãƒ¼ã‚¸ã®ã¿æ®‹ã—ã¾ã™ã€‚
         */
        const initialPortalData = {
            // ----------------------------------------------------
            // å…±é€šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š (ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸)
            // ----------------------------------------------------
            'default': { 
                title: 'å­¦ãƒˆãƒ“ãƒ© - å…±é€šå­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„',
                links: defaultLinks
            },
            
            // ----------------------------------------------------
            // å°å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ« (ã‚³ãƒ¼ãƒ‰: s/01-e) - éšå±¤æ§‹é€ ã‚’æŒã¤è©³ç´°å®šç¾©ã‚’ä¿æŒ
            // ----------------------------------------------------
            's/01-e': { 
                title: 'å°å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ« (ã‚³ãƒ¼ãƒ‰: 01)',
                links: [
                    { name: 'å­¦æ ¡å…±é€šã®ãŠçŸ¥ã‚‰ã›', url: 'https://example.com/01e-common' },
                    { name: '1å¹´ç”Ÿ ç®—æ•°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ (ã‚µãƒ–ãƒšãƒ¼ã‚¸)', url: '#s/01-e/g1' },
                    { name: '2å¹´ç”Ÿ å›½èªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ (ã‚µãƒ–ãƒšãƒ¼ã‚¸)', url: '#s/01-e/g2' },
                    { name: '3å¹´ç”Ÿ ç†ç§‘ãƒ»ç¤¾ä¼šã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#s/01-e/g3' },
                    { name: '4å¹´ç”Ÿ å¤–å›½èªå­¦ç¿’ã‚µã‚¤ãƒˆ', url: '#s/01-e/g4' },
                    { name: '5å¹´ç”Ÿ ç·åˆå­¦ç¿’è³‡æ–™', url: '#s/01-e/g5' },
                    { name: '6å¹´ç”Ÿ å’æ¥­åˆ¶ä½œè³‡æ–™', url: '#s/01-e/g6' },
                ]
            },
            
            // å°å­¦æ ¡ 2å¹´ç”Ÿã®éƒ¨å±‹ (å­¦å¹´å›ºæœ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„) - è©³ç´°å®šç¾©ã‚’ä¿æŒ
            's/01-e/g2': { 
                title: 'å°å­¦æ ¡ 2å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 01)',
                links: [
                    { name: "2å¹´ ç®—æ•°ãƒ‰ãƒªãƒ« (è¨ˆç®—)", url: "#" },
                    { name: "2å¹´ å›½èª (æ¼¢å­—ç·´ç¿’)", url: "#" },
                    { name: "2å¹´ ç”Ÿæ´»ç§‘ (å­¦ç¿’ã‚µã‚¤ãƒˆ)", url: "#" },
                    { name: "2å¹´ å­¦å¹´ã ã‚ˆã‚Š", url: "https://example.com/01e/g2/news" },
                ]
            },
            
            // ----------------------------------------------------
            // ä¸­å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ« (ã‚³ãƒ¼ãƒ‰: s/11-j) - è©³ç´°å®šç¾©ã‚’ä¿æŒ
            // ----------------------------------------------------
            's/11-j': { 
                title: 'ä¸­å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ« (ã‚³ãƒ¼ãƒ‰: 11)',
                links: [
                    { name: 'å­¦æ ¡å…±é€šã®ãŠçŸ¥ã‚‰ã›', url: 'https://example.com/11j-common' },
                    { name: '1å¹´ç”Ÿ å®šæœŸãƒ†ã‚¹ãƒˆå¯¾ç­– (ã‚µãƒ–ãƒšãƒ¼ã‚¸)', url: '#s/11-j/g1' },
                    { name: '2å¹´ç”Ÿ è·æ¥­ä½“é¨“è³‡æ–™ (ã‚µãƒ–ãƒšãƒ¼ã‚¸)', url: '#s/11-j/g2' },
                    { name: '3å¹´ç”Ÿ é€²è·¯æƒ…å ±ãƒãƒ¼ã‚¿ãƒ« (ã‚µãƒ–ãƒšãƒ¼ã‚¸)', url: '#s/11-j/g3' },
                    { name: 'å®šæœŸè€ƒæŸ»æ™‚é–“å‰²', url: '#' },
                ]
            },
            
            // ä¸­å­¦æ ¡ 3å¹´ç”Ÿã®éƒ¨å±‹ (å­¦å¹´å›ºæœ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„) - è©³ç´°å®šç¾©ã‚’ä¿æŒ
            's/11-j/g3': { 
                title: 'ä¸­å­¦æ ¡ 3å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 11)',
                links: [
                    { name: 'å—é¨“å¯¾ç­–ãƒ‰ãƒªãƒ«', url: "#" },
                    { name: 'é€²è·¯æƒ…å ±ãƒãƒ¼ã‚¿ãƒ«', url: "https://shingaku.example.com/" },
                    { name: '3å¹´ å­¦å¹´å…±é€š èª²é¡Œæå‡º', url: "#" },
                    { name: '3å¹´ å­¦å¹´ä¸»ä»»ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', url: "#" },
                ]
            },
            
            // ----------------------------------------------------
            // ãã®ä»–ã®å­¦æ ¡ã‚³ãƒ¼ãƒ‰ (ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼) - è©³ç´°å®šç¾©ã‚’ä¿æŒ
            // ----------------------------------------------------
            's/04-e': { 
                title: 'å°å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ« (ã‚³ãƒ¼ãƒ‰: 04)',
                links: [
                    { name: 'å­¦æ ¡å…±é€šã®ãŠçŸ¥ã‚‰ã›', url: 'https://example.com/04e-common' },
                    { name: '1å¹´ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#s/04-e/g1' },
                    { name: '2å¹´ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#s/04-e/g2' },
                    { name: '3å¹´ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#s/04-e/g3' },
                    { name: '4å¹´ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#s/04-e/g4' },
                    { name: '5å¹´ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#s/04-e/g5' },
                    { name: '6å¹´ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#s/04-e/g6' },
                ]
            },
            's/04-e/g4': { 
                title: 'å°å­¦æ ¡ 4å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 04)',
                links: [
                    { name: "4å¹´ ç†ç§‘ (è¦³å¯Ÿè¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ )", url: "#" },
                    { name: '4å¹´ ç·åˆå­¦ç¿’ï¼ˆç™ºè¡¨è³‡æ–™ï¼‰', url: '#' },
                    { name: '4å¹´ å¤–éƒ¨å­¦ç¿’ã‚µã‚¤ãƒˆ', url: 'https://external.example.com/g4' },
                ]
            },
            
            // ãã®ä»–ã®ã‚µãƒ–ãƒšãƒ¼ã‚¸ã‚‚ä¿æŒ (è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ä¸€èˆ¬ã‚³ãƒ¼ãƒ‰ã§ä¸Šæ›¸ãã•ã‚Œãªã„ã‚ˆã†ã«)
            's/01-e/g1': { title: 'å°å­¦æ ¡ 1å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 01)', links: [{ name: '1å¹´ æ‹…ä»»ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', url: '#' }] },
            's/01-e/g3': { title: 'å°å­¦æ ¡ 3å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 01)', links: [{ name: '3å¹´ ç¤¾ä¼šç§‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/01-e/g4': { title: 'å°å­¦æ ¡ 4å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 01)', links: [{ name: '4å¹´ éŸ³æ¥½ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/01-e/g5': { title: 'å°å­¦æ ¡ 5å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 01)', links: [{ name: '5å¹´ å›³å·¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/01-e/g6': { title: 'å°å­¦æ ¡ 6å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 01)', links: [{ name: '6å¹´ å’æ¥­æ–‡é›†è³‡æ–™', url: '#' }] },

            's/11-j/g1': { title: 'ä¸­å­¦æ ¡ 1å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 11)', links: [{ name: '1å¹´ æ•°å­¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/11-j/g2': { title: 'ä¸­å­¦æ ¡ 2å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 11)', links: [{ name: '2å¹´ è‹±èªã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },

            's/04-e/g1': { title: 'å°å­¦æ ¡ 1å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 04)', links: [{ name: '1å¹´ ç”Ÿæ´»ç§‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/04-e/g2': { title: 'å°å­¦æ ¡ 2å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 04)', links: [{ name: '2å¹´ ç®—æ•°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/04-e/g3': { title: 'å°å­¦æ ¡ 3å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 04)', links: [{ name: '3å¹´ å›½èªã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/04-e/g5': { title: 'å°å­¦æ ¡ 5å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 04)', links: [{ name: '5å¹´ ç¤¾ä¼šç§‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
            's/04-e/g6': { title: 'å°å­¦æ ¡ 6å¹´ç”Ÿã®éƒ¨å±‹ (ã‚³ãƒ¼ãƒ‰: 04)', links: [{ name: '6å¹´ ç†ç§‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', url: '#' }] },
        };
        
        // --- ã“ã“ã‹ã‚‰è‡ªå‹•ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ  ---

        /**
         * ã‚³ãƒ¼ãƒ‰01ã‹ã‚‰21ã¾ã§ã®å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆ-e/-jï¼‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã€‚
         * æ—¢ã«initialPortalDataã«å­˜åœ¨ã™ã‚‹ã‚­ãƒ¼ã¯ä¸Šæ›¸ãã—ãªã„ã€‚
         * è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒªãƒ³ã‚¯ã‚’åˆæœŸå€¤ã¨ã—ã¦æŒã¤ã€‚
         */
        function pad(num) {
            return num.toString().padStart(2, '0');
        }

        for (let i = 1; i <= 21; i++) {
            const code = pad(i);
            const elementaryKey = `s/${code}-e`;
            const juniorKey = `s/${code}-j`;

            // å°å­¦æ ¡ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¿½åŠ  (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒ³ã‚¯ã§åˆæœŸåŒ–)
            if (!initialPortalData[elementaryKey]) {
                initialPortalData[elementaryKey] = {
                    title: `å°å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ« (ã‚³ãƒ¼ãƒ‰: ${code})`, 
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦åˆæœŸåŒ–
                    links: JSON.parse(JSON.stringify(defaultLinks)) 
                };
            }

            // ä¸­å­¦æ ¡ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¿½åŠ  (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒ³ã‚¯ã§åˆæœŸåŒ–)
            if (!initialPortalData[juniorKey]) {
                initialPortalData[juniorKey] = {
                    title: `ä¸­å­¦æ ¡ãƒãƒ¼ã‚¿ãƒ« (ã‚³ãƒ¼ãƒ‰: ${code})`, 
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦åˆæœŸåŒ–
                    links: JSON.parse(JSON.stringify(defaultLinks))
                };
            }
            
            // æ³¨æ„: å­¦å¹´åˆ¥ã‚µãƒ–ãƒšãƒ¼ã‚¸ã®è‡ªå‹•ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã¯å‰Šé™¤ã—ã€åŸºæœ¬å½¢ã®ã¿ã¨ã—ã¾ã™ã€‚
        }

        // --- è‡ªå‹•ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã®è¿½åŠ çµ‚äº† ---

        let editablePortalData = {}; 
        const animationDuration = 500; 

        // ----------------------------------------------------
        // ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ã¨æ°¸ç¶šåŒ–ã®ãƒ­ã‚¸ãƒƒã‚¯
        // ----------------------------------------------------
        function loadPortalData() {
            let storedData = {};
            try {
                const storedJson = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (storedJson) {
                    storedData = JSON.parse(storedJson);
                }
            } catch (e) {
                console.error("Error loading or parsing localStorage data. Using initial data as base.", e);
            }

            // åˆæœŸãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸
            editablePortalData = { ...initialPortalData, ...storedData };

            savePortalData(editablePortalData);
        }

        function savePortalData(data) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
                editablePortalData = data; 
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
            }
        }
        
        // ----------------------------------------------------
        // ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨é·ç§»ã‚’åˆ¶å¾¡ã™ã‚‹é–¢æ•°
        // ----------------------------------------------------
        function handleLinkClick(e) {
            const url = new URL(this.href, window.location.href);
            // ãƒšãƒ¼ã‚¸å†…ãƒãƒƒã‚·ãƒ¥é·ç§»ã¯ãã®ã¾ã¾è¨±å¯
            if (url.hash && url.hash.startsWith('#')) {
                 return;
            }
            
            // å¤–éƒ¨URLã¾ãŸã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®å ´åˆã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«åˆ¥ã‚¿ãƒ–ã§é·ç§»
            if (this.href.endsWith('#') || this.href.includes('[') || this.href === '') {
                return; 
            }

            e.preventDefault(); 

            const targetUrl = this.href;
            
            this.classList.add('opening');

            setTimeout(() => {
                window.open(targetUrl, '_blank');
                
                setTimeout(() => {
                     this.classList.remove('opening');
                }, 100);

            }, animationDuration + 50); 
        }

        function attachAnimationListeners() {
            const linkButtons = document.querySelectorAll('.link-button');
            
            linkButtons.forEach(button => {
                button.removeEventListener('click', handleLinkClick); 
                button.addEventListener('click', handleLinkClick);
            });
        }

        // ----------------------------------------------------
        // URLãƒãƒƒã‚·ãƒ¥ã«åŸºã¥ã„ã¦ãƒãƒ¼ã‚¿ãƒ«ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
        // ----------------------------------------------------
        function renderPortal() {
            loadPortalData(); 

            // ä¿®æ­£: ãƒãƒƒã‚·ãƒ¥æ–‡å­—åˆ—ã‹ã‚‰å…ˆé ­ã®'#'ã‚’å–ã‚Šã€å°æ–‡å­—ã«ã—ã€
            // æœ«å°¾ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥( / )ã¨ç©ºç™½ã‚’å‰Šé™¤ã—ã¦æ­£è¦åŒ–ã™ã‚‹ã€‚
            const rawHash = window.location.hash.substring(1).toLowerCase().replace(/\/+$/, '').trim();
            
            const urlParams = new URLSearchParams(window.location.search);
            const isAdmin = urlParams.has('admin');
            
            const editButton = document.getElementById('edit-button');
            const emergencySection = document.getElementById('emergency-section');
            
            editButton.classList.toggle('hidden', !isAdmin); 

            // ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            let currentKey = rawHash;
            let data = editablePortalData[rawHash];
            
            // --- çŸ­ç¸®å½¢ (ä¾‹: #s/04) ã‹ã‚‰æ­£å¼ã‚³ãƒ¼ãƒ‰ã¸ã®è§£æ±º ---
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ s/XX ã®å½¢å¼ã§å…¥åŠ›ã—ãŸå ´åˆã€s/XX-e, s/XX-j ã‚’è©¦è¡Œã™ã‚‹
            if (!data && rawHash.startsWith('s/') && rawHash.split('/').length === 2) {
                const baseKey = rawHash;
                
                // è©¦è¡Œ1: å°å­¦æ ¡ã‚³ãƒ¼ãƒ‰ã¸ã®è§£æ±º (ä¾‹: s/04 -> s/04-e)
                if (editablePortalData[baseKey + '-e']) {
                    currentKey = baseKey + '-e';
                    data = editablePortalData[currentKey];
                } 
                // è©¦è¡Œ2: ä¸­å­¦æ ¡ã‚³ãƒ¼ãƒ‰ã¸ã®è§£æ±º (ä¾‹: s/11 -> s/11-j)
                else if (editablePortalData[baseKey + '-j']) {
                    currentKey = baseKey + '-j';
                    data = editablePortalData[currentKey];
                }
            }
            // ----------------------------------------------------------

            if (!data) {
                const parts = rawHash.split('/');
                
                // éšå±¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ (ä¾‹: s/01-e/g2/sub -> s/01-e/g2)
                if (parts.length >= 2) { 
                    const fallbackKey = parts.slice(0, parts.length - 1).join('/');
                    if (editablePortalData[fallbackKey] && fallbackKey !== '') { // ç©ºæ–‡å­—åˆ—ã¸ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’é˜²æ­¢
                        currentKey = fallbackKey;
                        data = editablePortalData[fallbackKey];
                    }
                }
                
                // æœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ (ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã€ã¾ãŸã¯ç„¡åŠ¹ãªã‚­ãƒ¼ã®å ´åˆ)
                if (!data) {
                    currentKey = 'default';
                    data = editablePortalData[currentKey];
                }
            }


            const container = document.getElementById('link-container');
            const titleElement = document.getElementById('main-section-title');
            
            // ç·Šæ€¥å¯¾å¿œã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
            // æ­£è¦åŒ–ã•ã‚ŒãŸãƒãƒƒã‚·ãƒ¥ (rawHash) ãŒå®Œå…¨ã«ç©ºã®æ–‡å­—åˆ— '' ã®å ´åˆã®ã¿è¡¨ç¤ºã‚’è¨±å¯ã™ã‚‹ã€‚
            const hashIsCompletelyEmpty = rawHash === '';
            emergencySection.classList.toggle('hidden', !hashIsCompletelyEmpty);

            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            titleElement.textContent = data.title;
            
            // æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¯ãƒªã‚¢
            container.innerHTML = '';

            // ãƒªãƒ³ã‚¯ã‚’å‹•çš„ã«ç”Ÿæˆ
            data.links.forEach(link => {
                const linkElement = document.createElement('a');
                linkElement.href = link.url;
                linkElement.className = 'link-button';
                
                // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒªãƒ³ã‚¯ã‚’ã‚µãƒ–ãƒšãƒ¼ã‚¸ã¸ã®ãƒãƒƒã‚·ãƒ¥ãƒªãƒ³ã‚¯ã«å¤‰æ›´
                if (!link.url.startsWith('http') && !link.url.includes('[')) {
                    linkElement.href = link.url; // '#' ã¾ãŸã¯ '#key'
                }
                
                linkElement.innerHTML = `<span class="door-icon"></span><span class="button-text">${link.name}</span>`;
                container.appendChild(linkElement);
            });
            
            attachAnimationListeners();
        }

        // ----------------------------------------------------
        // ç®¡ç†è€…ç·¨é›†æ©Ÿèƒ½ (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ãƒ¢ãƒ¼ãƒ€ãƒ«)
        // ----------------------------------------------------
        let currentEditingKey = null;

        function getCurrentEditingKey(rawHash) {
            let editingKey = rawHash || 'default';
            
            // çŸ­ç¸®å½¢è§£æ±ºã‚’ã“ã“ã§ã‚‚å®Ÿè¡Œï¼ˆãƒãƒ¼ã‚¿ãƒ«ç·¨é›†å¯¾è±¡ã‚­ãƒ¼ã®ç‰¹å®šã®ãŸã‚ï¼‰
            if (!editablePortalData[editingKey] && editingKey.startsWith('s/') && editingKey.split('/').length === 2) {
                const baseKey = editingKey;
                if (editablePortalData[baseKey + '-e']) {
                    editingKey = baseKey + '-e';
                } else if (editablePortalData[baseKey + '-j']) {
                    editingKey = baseKey + '-j';
                }
            }


            if (!editablePortalData[editingKey]) {
                const parts = editingKey.split('/');
                if (parts.length >= 2) { 
                    const fallbackKey = parts.slice(0, parts.length - 1).join('/');
                    if (editablePortalData[fallbackKey]) {
                        editingKey = fallbackKey; 
                    }
                }
                if (!editablePortalData[editingKey]) {
                    editingKey = 'default';
                }
            }
            return editingKey;
        }

        function handleEditClick() {
            const rawHash = window.location.hash.substring(1).toLowerCase().replace(/\/+$/, '').trim();
            
            const editingKey = getCurrentEditingKey(rawHash);

            // å­¦æ ¡ã‚³ãƒ¼ãƒ‰ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ (ä¾‹: 's/01-e') ã‚’å–å¾—
            const keyParts = editingKey.split('/');
            // ç·¨é›†å¯¾è±¡ã®ã‚­ãƒ¼ãŒ 's/xx-e' ã¾ãŸã¯ 's/xx-e/gy' ã®å½¢å¼ã®å ´åˆ
            // 's/xx-e' ã¾ãŸã¯ 's/xx-j' ã®å½¢å¼ãŒæ ¡ç¨®ã‚³ãƒ¼ãƒ‰
            const schoolPrefix = (keyParts.length >= 2 && keyParts[0] === 's' && keyParts[1].includes('-')) 
                               ? `${keyParts[0]}/${keyParts[1]}` 
                               : null;
            const isSchoolPage = !!schoolPrefix && SCHOOL_PASSWORDS[schoolPrefix];
            
            const requiredPassword = isSchoolPage ? SCHOOL_PASSWORDS[schoolPrefix] : ADMIN_PASSWORD;

            // ç°¡æ˜“ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
            const password = prompt(`ãƒãƒ¼ã‚¿ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n(å¯¾è±¡ã‚­ãƒ¼: #${editingKey})`);
            
            let authorized = false;

            if (isSchoolPage) {
                // å­¦æ ¡å›ºæœ‰ã®ãƒšãƒ¼ã‚¸ã®å ´åˆ: è©²å½“ã™ã‚‹å­¦æ ¡å›ºæœ‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã®ã¿ä¸€è‡´ã—ãªã‘ã‚Œã°ç·¨é›†ä¸å¯
                if (password === requiredPassword) {
                    authorized = true;
                } else {
                    console.error(`æ‰€å±æ ¡ãƒãƒ¼ã‚¿ãƒ«ç·¨é›†ä¸­ (${schoolPrefix}): ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚æ‰€å±æ ¡ã®å›ºæœ‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚`);
                }
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã‚„ã‚µãƒ–ãƒšãƒ¼ã‚¸ã®å ´åˆ: å…±é€šç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã®ã¿ä¸€è‡´ã—ãªã‘ã‚Œã°ç·¨é›†ä¸å¯
                if (password === ADMIN_PASSWORD) {
                    authorized = true;
                } else {
                    console.error("å…±é€šãƒãƒ¼ã‚¿ãƒ«ç·¨é›†ä¸­: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚");
                }
            }

            if (authorized) {
                showEditModal(editingKey);
            } else if (password !== null) {
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹å ´åˆã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                const button = document.getElementById('edit-button');
                const originalText = button.textContent;
                button.textContent = "âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸æ­£";
                button.style.backgroundColor = '#cc0000';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#3cb371';
                }, 1500);
            }
        }
        
        function showEditModal(editingKey) {
            currentEditingKey = editingKey;
            
            const editor = document.getElementById('json-editor');
            const modalTitle = document.getElementById('modal-title');
            const editModal = document.getElementById('edit-modal');
            
            modalTitle.textContent = `ãƒãƒ¼ã‚¿ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†: #${currentEditingKey}`;
            
            // ç·¨é›†å¯¾è±¡ã®ãƒªãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§æ•´å½¢ã—ã¦ã‚¨ãƒ‡ã‚£ã‚¿ã«è¡¨ç¤º
            const dataToEdit = editablePortalData[currentEditingKey];
            editor.value = JSON.stringify(dataToEdit, null, 2);
            
            editModal.style.display = 'flex';
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }
        
        function saveChanges() {
            const editor = document.getElementById('json-editor');
            let newPortalData;
            
            try {
                newPortalData = JSON.parse(editor.value);
            } catch (e) {
                console.error("JSONå½¢å¼ãŒä¸æ­£ã§ã™ã€‚ä¿å­˜ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚", e);
                
                const saveButton = document.querySelector('.modal-save');
                const originalText = saveButton.textContent;
                saveButton.textContent = "âŒ JSONã‚¨ãƒ©ãƒ¼: ã‚«ãƒ³ãƒã‚„å¼•ç”¨ç¬¦ã‚’ç¢ºèª";
                saveButton.style.backgroundColor = '#cc0000';
                setTimeout(() => {
                    saveButton.textContent = originalText;
                    saveButton.style.backgroundColor = '#0056b3';
                }, 3000); 
                return;
            }

            const updatedDataStore = { ...editablePortalData };
            // newPortalDataãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ã‚­ãƒ¼ã®æ§‹é€ ã‚’ä¿æŒ
            if (typeof newPortalData === 'object' && newPortalData !== null && newPortalData.hasOwnProperty('title') && newPortalData.hasOwnProperty('links')) {
                 updatedDataStore[currentEditingKey] = newPortalData;
            } else {
                 // ç·¨é›†å¯¾è±¡ã®æ§‹é€  (titleã¨linksã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ) ãŒå´©ã‚Œã¦ã„ãŸå ´åˆã®è­¦å‘Š
                 console.error("ä¿å­˜ã•ã‚ŒãŸJSONã®æ§‹é€ ãŒæœŸå¾…ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸ (title/linksãŒå­˜åœ¨ã—ãªã„)ã€‚");
                 const saveButton = document.querySelector('.modal-save');
                 const originalText = saveButton.textContent;
                 saveButton.textContent = "âŒ æ§‹é€ ã‚¨ãƒ©ãƒ¼: titleã¨linksãŒå¿…è¦ã§ã™";
                 saveButton.style.backgroundColor = '#cc0000';
                 setTimeout(() => {
                     saveButton.textContent = originalText;
                     saveButton.style.backgroundColor = '#0056b3';
                 }, 3000); 
                 return;
            }
            
            savePortalData(updatedDataStore);
            
            closeEditModal();
            renderPortal(); 
        }


        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã¨ãƒãƒƒã‚·ãƒ¥å¤‰æ›´æ™‚ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        document.addEventListener('DOMContentLoaded', () => {
             loadPortalData();
             renderPortal();
        });
        window.addEventListener('hashchange', renderPortal); 
        
        if (window.location.hash) {
            renderPortal();
        }
    </script>
</body>
</html>
